{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user account in the SentinelView system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "username": {
          "type": "string",
          "description": "The username of the user."
        },
        "email": {
          "type": "string",
          "description": "The email address of the user.",
          "format": "email"
        },
        "photoURL": {
            "type": "string",
            "description": "The URL of the user's profile picture."
        },
        "registrationDate": {
          "type": "string",
          "description": "The date and time the user registered.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "email"
      ]
    },
    "LogEntry": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "LogEntry",
      "type": "object",
      "description": "Represents a log entry collected by the system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the log entry."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N LogEntry)"
        },
        "timestamp": {
          "type": "string",
          "description": "The timestamp of the log entry.",
          "format": "date-time"
        },
        "source": {
          "type": "string",
          "description": "The source of the log entry (e.g., application name, server)."
        },
        "message": {
          "type": "string",
          "description": "The log message."
        },
        "severity": {
          "type": "string",
          "description": "The severity level of the log entry (e.g., INFO, WARNING, ERROR)."
        }
      },
      "required": [
        "id",
        "userId",
        "timestamp",
        "source",
        "message",
        "severity"
      ]
    },
    "Alert": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Alert",
      "type": "object",
      "description": "Represents a security alert generated by the system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the alert."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Alert)"
        },
        "timestamp": {
          "type": "string",
          "description": "The timestamp of when the alert was triggered.",
          "format": "date-time"
        },
        "description": {
          "type": "string",
          "description": "A description of the alert."
        },
        "severity": {
          "type": "string",
          "description": "The severity level of the alert (e.g., HIGH, MEDIUM, LOW)."
        },
        "status": {
          "type": "string",
          "description": "The status of the alert (e.g., OPEN, ACKNOWLEDGED, CLOSED)."
        }
      },
      "required": [
        "id",
        "userId",
        "timestamp",
        "description",
        "severity",
        "status"
      ]
    },
    "Report": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Report",
      "type": "object",
      "description": "Represents a security report generated by the system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the report."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Report)"
        },
        "generatedAt": {
          "type": "string",
          "description": "The timestamp of when the report was generated.",
          "format": "date-time"
        },
        "parameters": {
          "type": "string",
          "description": "Parameters used to generate this report stored in JSON format."
        },
        "content": {
          "type": "string",
          "description": "The content of the report (e.g., in Markdown or HTML format)."
        }
      },
      "required": [
        "id",
        "userId",
        "generatedAt",
        "content"
      ]
    },
     "Conversation": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Conversation",
      "type": "object",
      "description": "Represents a chat conversation between two or more users.",
      "properties": {
        "participants": {
          "type": "array",
          "items": { "type": "string" },
          "description": "An array of user IDs participating in the conversation."
        },
        "lastMessage": {
          "type": "string",
          "description": "The text of the last message sent in the conversation."
        },
        "lastMessageTimestamp": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp of the last message."
        }
      },
      "required": ["participants"]
    },
    "Message": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Message",
      "type": "object",
      "description": "Represents a single message within a conversation.",
      "properties": {
        "senderId": {
          "type": "string",
          "description": "The ID of the user who sent the message."
        },
        "text": {
          "type": "string",
          "description": "The content of the message."
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp when the message was sent."
        }
      },
      "required": ["senderId", "text", "timestamp"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "google.com",
      "github.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. The `userId` is used to identify the user. No denormalization required as this is the root entity.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/log_entries/{logEntryId}",
        "definition": {
          "entityName": "LogEntry",
          "schema": {
            "$ref": "#/backend/entities/LogEntry"
          },
          "description": "Stores log entries for a specific user. Includes denormalized 'userId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "logEntryId",
              "description": "The unique identifier for the log entry."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/alerts/{alertId}",
        "definition": {
          "entityName": "Alert",
          "schema": {
            "$ref": "#/backend/entities/Alert"
          },
          "description": "Stores alerts for a specific user. Includes denormalized 'userId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "alertId",
              "description": "The unique identifier for the alert."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/reports/{reportId}",
        "definition": {
          "entityName": "Report",
          "schema": {
            "$ref": "#/backend/entities/Report"
          },
          "description": "Stores reports for a specific user. Includes denormalized 'userId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "reportId",
              "description": "The unique identifier for the report."
            }
          ]
        }
      },
       {
        "path": "/conversations/{conversationId}",
        "definition": {
          "entityName": "Conversation",
          "schema": { "$ref": "#/backend/entities/Conversation" },
          "description": "Top-level collection for conversations. The document contains metadata about the chat.",
          "params": [
            {
              "name": "conversationId",
              "description": "The unique identifier for the conversation."
            }
          ]
        }
      },
      {
        "path": "/conversations/{conversationId}/messages/{messageId}",
        "definition": {
          "entityName": "Message",
          "schema": { "$ref": "#/backend/entities/Message" },
          "description": "Subcollection storing all messages for a given conversation.",
          "params": [
            {
              "name": "conversationId",
              "description": "The unique identifier for the conversation."
            },
            {
              "name": "messageId",
              "description": "The unique identifier for the message."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure secure and scalable data management for the SentinelView application. It prioritizes authorization independence, clarity, and ease of debugging, following the principles outlined.  Authorization Independence is achieved by using path-based ownership for User data and storing the User ID directly within child documents.  Structural Segregation is applied by separating User data into its own collection.  Access Modeling is implemented using path-based ownership. For instance, log entries, alerts, and reports are stored as subcollections under the `/users/{userId}` path, making ownership explicit and simplifying security rules. This structure also enables secure list operations (QAPs) by scoping queries to user-owned data.\n\nThe `/users/{userId}` collection stores user profiles.  Log entries, alerts, and reports related to a specific user are stored within subcollections of the user's document, ensuring clear ownership and simplified querying. This approach makes security rules straightforward and efficient, as they can be based on the user ID in the path.\n\nThe new chat feature uses a top-level `/conversations` collection to facilitate queries between multiple users without complex subcollection group queries. Security is maintained by checking if a user's ID is present in the `participants` array of a conversation document."
  }
}
